# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Ÿè¡ŒåŸå‰‡ (ç¬¬1æ¡-ç¬¬10æ¡)

**å¿…é ˆå®£è¨€**: å…¨ã¦ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä½œæ¥­é–‹å§‹æ™‚ã«å¿…ãšcore_principlesã‚’å®Œå…¨ã«å®£è¨€ã™ã‚‹ã“ã¨

### ç¬¬1æ¡
å¸¸ã«æ€è€ƒé–‹å§‹å‰ã«Claude.mdã®ç¬¬1æ¡ã‹ã‚‰ç¬¬10æ¡ã®AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åŸå‰‡ã‚’å…¨ã¦å®£è¨€ã—ã¦ã‹ã‚‰å®Ÿæ–½ã™ã‚‹

### ç¬¬2æ¡
å¸¸ã«ãƒ—ãƒ­ã®ä¸–ç•Œæœ€é«˜ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦å¯¾å¿œã™ã‚‹

### ç¬¬3æ¡
ãƒ¢ãƒƒã‚¯ã‚„ä»®ã®ã‚³ãƒ¼ãƒ‰ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’ä¸€åˆ‡ç¦æ­¢ã™ã‚‹ã€‚ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‰ã«read Serena's initial instructionsã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æ–°è¦æ©Ÿèƒ½ã®å®Ÿè£…æŒ‡ç¤ºã‚’å—ã‘ãŸã‚‰ã€ã¾ãšã¯tmpãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¦ã€‚æ—¢å­˜ã®å®Ÿè£…ã‚’serena mcpã‚’åˆ©ç”¨ã—ã¦è©³ç´°ã«åˆ†æã—ã€ãƒ—ãƒ­ã¨ã—ã¦æ¥ãšã‹ã—ããªã„å®Ÿè£…ã‚’è¨ˆç”»ã—ã¦ã€‚

### ç¬¬4æ¡
ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…ã‚’å®Ÿæ–½ã—ã€ä¿®æ­£ã¯è¡¨é¢çš„ã§ã¯ãªãã€å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ„è­˜ã—ã¦å®Ÿæ–½ã™ã‚‹

### ç¬¬5æ¡
å•é¡Œã«è©°ã¾ã£ãŸã‚‰ã€ã¾ãšCLAUDE.mdã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã«è§£æ±ºç­–ãŒãªã„ã‹ç¢ºèªã™ã‚‹

### ç¬¬6æ¡
é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©ã€pushå‰ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¹ãã§ã¯ãªã„æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã™ã‚‹ã€‚ä½œæ¥­å®Œäº†ã”ã¨ã«githubã«çŠ¶æ³ã‚’pushã™ã‚‹ã€‚æ¯å›ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã¯å¿…ãšgithubã«pushã™ã‚‹ã“ã¨ã€‚

### ç¬¬7æ¡
ä¸è¦ãªæ–‡æ›¸ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¢—ã‚„ã•ãªã„ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆæ™‚ã¯å¸¸ã«æ—¢å­˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä½¿ç”¨å¯èƒ½ãªã‚‚ã®ãŒãªã„ã‹ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ãŸã‚‰scriptsãƒ•ã‚©ãƒ«ãƒ€ã«ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«æ ¼ç´ã™ã‚‹ã€‚ä¸€æ™‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„æ–‡æ›¸ã¯ãã‚Œãã‚Œã®ãƒ•ã‚©ãƒ«ãƒ€ã®tmpãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã—ã€ä½¿ç”¨å¾Œã«å¿…ãšå‰Šé™¤ã™ã‚‹ã€‚

### ç¬¬8æ¡
ãƒ‡ã‚¶ã‚¤ãƒ³ã¯https://atlassian.design/components ã‚’èª­ã¿è¾¼ã¿ã€ã“ã‚Œã«æº–æ‹ ã™ã‚‹ã€‚

### ç¬¬9æ¡
ä½œæ¥­å®Œäº†å¾Œã«ã‚‚ã†ä¸€åº¦ã™ã¹ã¦ã®å®£è¨€ã‚’å®Ÿæ–½ã—ã€å®£è¨€ã©ãŠã‚Šã«ä½œæ¥­ã‚’å®Ÿæ–½ã§ãã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚

### ç¬¬10æ¡
ãƒã‚°ã‚’ä¿®æ­£ã™ã‚‹å ´åˆã¯ã€serena mcp ã‚’åˆ©ç”¨ã—ã¦åŸå› ã®åˆ†æã‚’ã—ã€tmpãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«å ±å‘Šè³‡æ–™ã‚’ä½œæˆã—ã¦ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŸå› ã«ã¤ã„ã¦å ±å‘Šã™ã‚‹ã€‚ã™ã§ã«åŒæ§˜ã®ãƒã‚°ã®å ±å‘Šè³‡æ–™ãŒã‚ã‚‹å ´åˆã¯ã€ãã‚Œã‚’æ›´æ–°ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªã—ãŸã‚‰ä¿®æ­£æ–¹æ³•ã‚’ææ¡ˆã™ã‚‹ã€‚ä¿®æ­£æ–¹æ³•ãŒå¦¥å½“ã‹ååˆ†ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€ä»–ã®å®£è¨€ã«çŸ›ç›¾ã—ã¦ã„ãªã„ã‹ç¢ºèªã—ãŸä¸Šã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¢ºèªã‚’ã¨ã‚Šä¿®æ­£ã‚’å®Ÿæ–½ã™ã‚‹ã€‚ãƒã‚°å ±å‘Šã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã€tmpãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«ä¿å­˜ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚°ãŒè§£æ±ºã—ãŸã¨è¨€ã†ã¾ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã—ã€ãƒã‚°ãŒè§£æ±ºã—ãŸã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å‰Šé™¤ã™ã‚‹ã€‚

## å®Ÿè¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ä½œæ¥­é–‹å§‹å‰
- [ ] ç¬¬1æ¡ã‹ã‚‰ç¬¬10æ¡ã®å®Œå…¨å®£è¨€ã‚’å®Ÿæ–½
- [ ] Serena's initial instructionsã‚’èª­ã¿è¾¼ã¿
- [ ] æ—¢å­˜å®Ÿè£…ã®è©³ç´°åˆ†æ
- [ ] å®Ÿè£…è¨ˆç”»ã®ä½œæˆï¼ˆtmpãƒ•ã‚©ãƒ«ãƒ€ï¼‰

### ä½œæ¥­ä¸­
- [ ] ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…
- [ ] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“ã‚’æ„è­˜ã—ãŸä¿®æ­£
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- [ ] é©åˆ‡ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®ç¶­æŒ

### ä½œæ¥­å®Œäº†å¾Œ
- [ ] å…¨å®£è¨€ã¨ã®æ•´åˆæ€§ç¢ºèª
- [ ] ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œã¨ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œå¿…ãšGitHubã¸ã®push
- [ ] tmpãƒ•ã‚©ãƒ«ãƒ€ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- [ ] å®Œäº†å ±å‘Š

## ãƒ•ã‚¡ã‚¤ãƒ«çµ„ç¹”ãƒ«ãƒ¼ãƒ«
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: scriptsãƒ•ã‚©ãƒ«ãƒ€
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: documentsãƒ•ã‚©ãƒ«ãƒ€  
- **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«**: å„ãƒ•ã‚©ãƒ«ãƒ€/tmpã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆä½¿ç”¨å¾Œå‰Šé™¤ï¼‰
- **ãƒã‚°å ±å‘Š**: documents/tmpãƒ•ã‚©ãƒ«ãƒ€ï¼ˆè§£æ±ºã¾ã§ä¿æŒï¼‰

## Important Workflow Guidelines

### ğŸš« Emergency Deploy å®Œå…¨ç¦æ­¢
**emergency-deploy/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½¿ç”¨ã¯å®Œå…¨ã«ç¦æ­¢**
- âŒ ç†ç”±: ä¸å®Œå…¨ãªHTMLãƒ•ã‚¡ã‚¤ãƒ«ã€Reactæ©Ÿèƒ½æ¬ å¦‚ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- âŒ çµæœ: æœ¬ç•ªç’°å¢ƒã§ã®æ©Ÿèƒ½ä½ä¸‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æ‚ªåŒ–
- âœ… æ­£è§£: å¸¸ã« `frontend/webapp/build/` ã®å®Œå…¨ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ç”¨

### Completion of Work
1. **GitHub Commit**: ä½œæ¥­ãŒå®Œäº†ã—ãŸã‚‰GitHubã«è¿½åŠ ã™ã‚‹ã“ã¨
   - å¤‰æ›´å†…å®¹ã‚’å¿…ãšã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
   - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§ã‚‚è‹±èªã§ã‚‚å¯

2. **Build and Deploy**: ä½œæ¥­ãŒå®Œäº†ã—ãŸã‚‰Claudeç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰ã—ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨
   ```bash
   # frontendãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆ
   cd frontend/webapp
   npm run build
   wrangler pages deploy build --project-name=pfwise-portfolio-manager
   ```

3. **Update README**: READMEã«ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’è¨˜è¼‰ã—ã¦
   - æœ¬ç•ªç’°å¢ƒURL: https://portfolio-wise.com/
   - é–‹ç™ºç’°å¢ƒURL: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã¯æ¯å›å¤‰ã‚ã‚‹ãŸã‚è¨˜è¼‰ä¸è¦

### Security Considerations
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯**: GitHubã¸ã®ãƒ—ãƒƒã‚·ãƒ¥å‰ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡ŒãŒãªã„ã‹ç¢ºèªã™ã‚‹ã“ã¨
  - APIã‚­ãƒ¼ã‚„ç§˜å¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
  - .envãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
  - console.logã§ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªæƒ…å ±ã‚’å‡ºåŠ›ã—ã¦ã„ãªã„ã‹ç¢ºèª

### Documentation Updates
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: å®Ÿè£…ã‚’å¤‰æ›´ã—ãŸã‚‰ãã‚Œã«åˆã‚ã›ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚æ›´æ–°ã™ã‚‹ã“ã¨
  - æŠ€è¡“çš„ãªå¤‰æ›´ã¯CLAUDE.mdã«è¨˜è¼‰
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®å¤‰æ›´ã¯README.mdã«è¨˜è¼‰
  - APIä»•æ§˜ã®å¤‰æ›´ã¯è©²å½“ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰

### Production Deployment
- **å›ºå®šURLä½¿ç”¨**: å¿…ãšURLãŒå›ºå®šã®æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚ˆã†ã«ã—ã¦
  - æœ¬ç•ªç’°å¢ƒ: https://portfolio-wise.com/
  - Cloudflare Pagesã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨
  - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã¯é–‹ç™ºç¢ºèªç”¨ã®ã¿

### API Configuration
- **å›ºå®šAPIä½¿ç”¨**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é€šä¿¡ãŒå¿…ãšæˆåŠŸã™ã‚‹ã‚ˆã†ã«å›ºå®šã®APIã‚’æŒ‡å®šã—ã¦
  - æœ¬ç•ªAPI: https://gglwlh6sc7.execute-api.us-west-2.amazonaws.com/prod
  - ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®š:
    ```bash
    REACT_APP_API_BASE_URL='https://gglwlh6sc7.execute-api.us-west-2.amazonaws.com/prod' \
    REACT_APP_DEFAULT_EXCHANGE_RATE='150.0' \
    npm run build
    ```

## Commands

### Development
```bash
# Start development server
npm start

# Build for production
npm run build

# Run all tests with coverage
npm test

# Run specific test suites
npm run test:unit          # Unit tests only
npm run test:integration   # Integration tests
npm run test:e2e          # End-to-end tests

# Advanced test options (using script/run-tests.sh)
npm run test:all          # All tests
npm run test:coverage-chart  # Generate visual coverage report
npm run test:visual       # Open coverage in browser

# Run a single test file
npm test -- path/to/test.js
```

## Architecture Overview

This is a React-based portfolio management application with AI-powered investment analysis capabilities. Key architectural decisions:

### Frontend Architecture
- **React 18** with functional components and hooks
- **Context API** for state management (AuthContext for auth, PortfolioContext for portfolio data)
- **TailwindCSS** for styling with custom theme colors
- **Recharts** for data visualization
- **Google OAuth** for authentication
- **Axios** for API calls with retry logic

### Testing Architecture
- **Jest + React Testing Library** for unit/integration tests
- **MSW (Mock Service Worker)** for API mocking
- Custom test runner script (`script/run-tests.sh`) with advanced options
- Coverage thresholds enforced (70-80% target)
- Visual coverage reporting with chart generation

### Key Patterns

1. **Service Layer Pattern**: All API calls go through `/src/services/` modules
   - `api.js`: Core API client with auth handling
   - `marketDataService.js`: Market data fetching with fallbacks
   - `adminService.js`: Admin functionality

2. **Context Bridge Pattern**: `ContextConnector` component bridges AuthContext and PortfolioContext

3. **Environment Configuration**: All API settings are dynamically fetched from AWS
   - No API URLs or keys stored in client
   - Configuration fetched from AWS at runtime
   - Enhanced security and easier maintenance

4. **Component Organization**:
   ```
   components/
   â”œâ”€â”€ auth/       # LoginButton, UserProfile
   â”œâ”€â”€ common/     # ErrorBoundary, ToastNotification, etc.
   â”œâ”€â”€ dashboard/  # Portfolio visualization components
   â”œâ”€â”€ data/       # Import/Export, Google Drive integration
   â”œâ”€â”€ layout/     # Header, TabNavigation, DataStatusBar
   â”œâ”€â”€ settings/   # Holdings/Allocation editors, AI prompt settings
   â””â”€â”€ simulation/ # Investment simulation components
   ```

## Important Implementation Details

### Deployment
- **Frontend Hosting**: Cloudflare Pages (migrated from Netlify)
- **Backend API**: AWS Lambda + API Gateway
- **Database**: Amazon DynamoDB
- **Authentication**: Google OAuth + AWS Cognito

## Deployment Commands

### Frontend Deployment to Cloudflare Pages

```bash
# 1. Build the project
cd frontend/webapp
npm install
npm run build

# 2. Deploy to Cloudflare Pages
wrangler pages deploy build --project-name=portfolio-manager
```

### Backend Deployment to AWS

```bash
# 1. Install dependencies
cd backend
npm install

# 2. Install required serverless plugin (if needed)
npm install serverless-dotenv-plugin --save-dev

# 3. Deploy to production
npm run deploy:prod
```

### Environment Variables for Cloudflare Pages

Set these in Cloudflare Pages dashboard:
- `REACT_APP_API_BASE_URL`: https://gglwlh6sc7.execute-api.us-west-2.amazonaws.com/prod
- `REACT_APP_DEFAULT_EXCHANGE_RATE`: 150.0

### CORS Configuration

The backend serverless.yml is configured to allow:
- https://portfolio-manager-7bx.pages.dev
- https://*.portfolio-manager-7bx.pages.dev
- https://portfolio-wise.com

### API Integration
- All API endpoints dynamically configured from AWS
- Production API hosted on AWS (separate repository)
- **Batch API**: Use `fetchMultipleStocks` to fetch multiple tickers in one request
- Supports multiple market data sources with automatic fallback
- API keys and authentication handled server-side
- **Rate Limiting**: Circuit breakers, exponential backoff, request deduplication
- **Session-based auth**: Uses cookies with `withCredentials: true`

### Multi-Currency Support
- Handles JPY and USD
- Exchange rate fetching from multiple sources
- Automatic currency conversion in calculations

### AI Features
- Custom prompt generation for investment analysis
- Configurable AI settings in Settings page
- Integration with external AI services via prompts

### Data Persistence
- Google Drive integration for backup/restore
- Local storage for offline capability
- Export to CSV/JSON formats

### Testing Requirements
- All new components need corresponding tests in `__tests__/unit/components/`
- Integration tests for API interactions in `__tests__/integration/`
- Mock handlers in `__tests__/mocks/handlers.js`
- Use existing test patterns and utilities

## Development Tips

1. When modifying API calls, update both the service layer and corresponding MSW handlers
2. Run tests before committing - the project has strict coverage requirements
3. Use the visual coverage report to identify untested code paths
4. Follow the existing component structure and naming conventions
5. Ensure mobile responsiveness - the app is optimized for iOS devices
6. Consider Japanese users (primary target audience) in UI/UX decisions

## Security Configuration

### Environment Variables
API configurations are fetched dynamically from AWS. The following environment variables are supported:

1. Required environment variables:
   ```bash
   REACT_APP_API_BASE_URL=https://YOUR_AWS_API_URL_HERE.execute-api.YOUR_REGION.amazonaws.com
   REACT_APP_DEFAULT_EXCHANGE_RATE=150.0
   ```

2. Setup instructions:
   ```bash
   cp .env.example .env.development
   cp .env.example .env.production
   # Edit files to replace YOUR_AWS_API_URL_HERE with actual URL
   ```

3. API endpoints, keys, and Google Client ID are fetched from AWS at runtime using the base URL

4. The `.gitignore` file is configured to exclude all `.env*` files except `.env.example`

5. For production deployments, set `REACT_APP_API_BASE_URL` in your hosting platform's environment variables

### API Security
- All API configurations are managed server-side on AWS
- API keys and sensitive data never exposed to client
- CORS restrictions enforced on the backend
- Rate limiting based on authentication status
- **Authentication**: Session-based using cookies (no JWT tokens currently)
- **Important**: Backend needs to implement JWT token response for full functionality

### Test Environment Setup

1. **Local Testing**:
   ```bash
   # First time setup
   cp .env.test.example .env.test
   # Edit .env.test and replace YOUR_AWS_API_URL_HERE with actual URL
   
   # Run tests
   npm test
   ```

2. **CI/CD Environment** (GitHub Actions, etc.):
   - Add `REACT_APP_MARKET_DATA_API_URL` as a secret in your CI/CD platform
   - The test runner will automatically use environment variables if available
   
3. **Using Mock API**:
   - If `USE_API_MOCKS=true` is set in .env.test, tests will use MSW mocks instead of real API
   - This is useful for unit tests and when the backend is unavailable

## Deployment and URL Management

### Production URL
- **Primary Domain**: https://portfolio-wise.com/
- **Hosting**: Cloudflare Pages
- **Important**: Only this URL is registered with Google OAuth. Preview URLs (e.g., https://abc123.portfolio-manager-7bx.pages.dev) will NOT work for authentication.

### Deployment Process
1. **Build the production bundle**:
   ```bash
   cd frontend/webapp
   REACT_APP_API_BASE_URL='https://YOUR_AWS_API_URL.execute-api.REGION.amazonaws.com/prod' \
   REACT_APP_DEFAULT_EXCHANGE_RATE='150.0' \
   NODE_OPTIONS='--openssl-legacy-provider' \
   npm run build
   ```

2. **Deploy to Cloudflare Pages**:
   ```bash
   wrangler pages deploy build --project-name=portfolio-manager
   ```
   This creates a preview URL (e.g., https://abc123.portfolio-manager-7bx.pages.dev)

3. **Production Deployment**:
   - The deployment automatically promotes to https://portfolio-wise.com/ when pushed to the main branch
   - Custom domain is configured in Cloudflare Pages settings
   - SSL certificates are managed automatically by Cloudflare
   - **Note**: GitHub Actions is NOT used for deployment. Manual deployment via Wrangler CLI is required.

### Important Notes on URLs
- **Preview URLs**: Generated for each deployment, useful for testing UI changes but cannot authenticate with Google
- **Production URL**: Fixed domain (portfolio-wise.com) that is registered with Google OAuth
- **Google OAuth Redirect URIs**: Only the following are registered:
  - https://portfolio-wise.com/auth/google/callback
  - https://portfolio-wise.com/ (for popup auth)
  
Never attempt to add preview URLs to Google OAuth settings as they change with each deployment.