# APIレート制限エラー（429）の解決方法

## 問題
- AWS APIゲートウェイのレート制限（1時間あたり20リクエスト）に達している
- 頻繁な為替レート更新により、APIリクエストが多すぎる

## 実装した解決策

### 1. 為替レートのキャッシュ機能
- **5分間**のキャッシュを実装
- localStorage を使用して為替レートを保存
- キャッシュが有効な間は新しいAPIリクエストを送信しない

### 2. フォールバック機能の強化
- API呼び出しが失敗した場合、デフォルト値を使用
- USD/JPY: 150.0
- JPY/USD: 0.00667

### 3. エラーメッセージの改善
- "Google Client IDが設定されていません" → "認証設定を読み込み中..."
- エラーではなく、読み込み状態として表示

## 追加の推奨事項

### 1. バッチAPI の活用
複数銘柄のデータを一度に取得：
```javascript
// 個別呼び出しの代わりに
const data1 = await fetchStockData('AAPL');
const data2 = await fetchStockData('GOOGL');

// バッチ呼び出しを使用
const data = await fetchMultipleStocks(['AAPL', 'GOOGL']);
```

### 2. 更新頻度の制限
- リアルタイム更新を必要最小限に
- ユーザーアクション時のみ更新
- バックグラウンド更新の間隔を広げる

### 3. 認証ユーザーの優遇
- Googleログイン後は制限が100リクエスト/時に増加
- ログインを促すメッセージを表示

## 現在の状態
- 為替レートキャッシュにより、API呼び出しが大幅に削減
- フォールバック値により、API制限時でもアプリは動作継続
- ユーザー体験を損なわずにAPI使用量を削減