# æ ªä¾¡å–å¾—ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾å¿œç‰ˆï¼‰

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 6.0  
**æœ€çµ‚æ›´æ–°æ—¥æ™‚:** 2025/03/28

## 1. æ¦‚è¦

æœ¬ä»•æ§˜æ›¸ã¯ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã™ã‚‹æ ªä¾¡å–å¾—ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã¨å®Ÿè£…ã«ã¤ã„ã¦å®šç¾©ã—ã¾ã™ã€‚ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã¦æ ªä¾¡æƒ…å ±ã‚’åŠ¹ç‡çš„ã‹ã¤ä¿¡é ¼æ€§é«˜ãå–å¾—ã—ã¾ã™ã€‚éŠ˜æŸ„ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦æœ€é©ãªãƒ‡ãƒ¼ã‚¿å–å¾—æ–¹æ³•ã‚’é¸æŠã—ã€ä¸»è¦ã‚½ãƒ¼ã‚¹ãŒå¤±æ•—ã—ãŸå ´åˆã¯ä»£æ›¿ã‚½ãƒ¼ã‚¹ã‚’è©¦è¡Œã™ã‚‹å …ç‰¢ãªä»•çµ„ã¿ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

## 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹æ§‹æˆ

### 2.1 ãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹
- **ç±³å›½æ ª**: Alpaca API
- **æ—¥æœ¬æ ª**: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆè¤‡æ•°ã‚µã‚¤ãƒˆï¼‰
- **æŠ•è³‡ä¿¡è¨—**: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆè¤‡æ•°ã‚µã‚¤ãƒˆï¼‰

### 2.2 ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚½ãƒ¼ã‚¹ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
- **ç±³å›½æ ª**: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆè¤‡æ•°ã‚µã‚¤ãƒˆï¼‰
- **å…¨éŠ˜æŸ„å…±é€š**: Yahoo Finance API

### 2.3 ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆå–å¾—
- **ä¸»è¦ã‚½ãƒ¼ã‚¹**: exchangerate.host API
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆç’°å¢ƒå¤‰æ•°ï¼‰

## 3. éŠ˜æŸ„ã‚¿ã‚¤ãƒ—ã®è‡ªå‹•åˆ¤åˆ¥

### 3.1 åˆ¤åˆ¥ãƒ­ã‚¸ãƒƒã‚¯
```javascript
// æŠ•è³‡ä¿¡è¨—ã‹ã©ã†ã‹ã‚’åˆ¤å®š
function isMutualFund(ticker) {
  return /^\d{7,8}C(\.T)?$/.test(ticker);
}

// æ—¥æœ¬æ ªã‹ã©ã†ã‹ã‚’åˆ¤å®š
function isJapaneseStock(ticker) {
  return /^\d{4}(\.T)?$/.test(ticker) || ticker.endsWith('.T');
}

// ç±³å›½æ ªã¯ãã‚Œä»¥å¤–ã®éŠ˜æŸ„ã¨åˆ¤æ–­
```

### 3.2 åˆ¤åˆ¥ã®å„ªå…ˆé †ä½
1. æŠ•è³‡ä¿¡è¨—ï¼ˆ7-8æ¡ã®æ•°å­—+Cï¼‰
2. æ—¥æœ¬æ ªï¼ˆ4æ¡ã®æ•°å­—ã¾ãŸã¯.Tä»˜ãï¼‰
3. ãã®ä»–ï¼ˆç±³å›½æ ªã¨åˆ¤æ–­ï¼‰

## 4. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ã‚ˆã‚‹æ—¥æœ¬æ ªå–å¾—

### 4.1 å¯¾è±¡ã‚µã‚¤ãƒˆï¼ˆå„ªå…ˆé †ï¼‰
1. Yahoo Finance Japan
2. Minkabu
3. Kabutan

### 4.2 å®Ÿè£…æ–¹æ³•
- Netlify Functionsã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°
- å„ã‚µã‚¤ãƒˆã‹ã‚‰æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚ŒãŸUser-Agentã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚’å›é¿
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã¨å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

### 4.3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Base URL**: `/api/jp-stock-scraping-proxy`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `code` (è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰)

### 4.4 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
```json
{
  "success": true,
  "data": {
    "ticker": "7203",
    "price": 2500,
    "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š(æ ª)",
    "currency": "JPY",
    "lastUpdated": "2025-03-25T03:24:15.456Z",
    "source": "Yahoo Finance Japan",
    "isStock": true,
    "isMutualFund": false
  }
}
```

## 5. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ã‚ˆã‚‹æŠ•è³‡ä¿¡è¨—å–å¾—

### 5.1 å¯¾è±¡ã‚µã‚¤ãƒˆï¼ˆå„ªå…ˆé †ï¼‰
1. Yahoo Finance Japan
2. æŠ•è³‡ä¿¡è¨—å”ä¼š
3. Morningstar Japan
4. Minkabu

### 5.2 å®Ÿè£…æ–¹æ³•
- Netlify Functionsã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°
- å„ã‚µã‚¤ãƒˆã‹ã‚‰åŸºæº–ä¾¡é¡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚ŒãŸUser-Agentã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚’å›é¿
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã¨å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

### 5.3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Base URL**: `/api/mutual-fund-scraping-proxy`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `code` (ãƒ•ã‚¡ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰)

### 5.4 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
```json
{
  "success": true,
  "data": {
    "ticker": "8630042C",
    "price": 12500,
    "name": "ãƒ‹ãƒƒã‚»ã‚¤ å¤–å›½æ ªå¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ãƒ³ãƒ‰",
    "currency": "JPY",
    "lastUpdated": "2025-03-25T03:24:15.456Z",
    "source": "æŠ•è³‡ä¿¡è¨—å”ä¼š",
    "isStock": false,
    "isMutualFund": true,
    "priceLabel": "åŸºæº–ä¾¡é¡"
  }
}
```

## 6. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ã‚ˆã‚‹ç±³å›½æ ªãƒ»ETFå–å¾—ï¼ˆæ–°è¦è¿½åŠ ï¼‰

### 6.1 å¯¾è±¡ã‚µã‚¤ãƒˆï¼ˆå„ªå…ˆé †ï¼‰
1. Yahoo Finance
2. MarketWatch
3. Investing.com

### 6.2 å®Ÿè£…æ–¹æ³•
- Netlify Functionsã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°
- å„ã‚µã‚¤ãƒˆã‹ã‚‰æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚ŒãŸUser-Agentã¨Refererã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚’å›é¿
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã¨å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- æ ªå¼ã¨ETFã®è‡ªå‹•åˆ¤åˆ¥

### 6.3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Base URL**: `/api/stock-scraping-proxy`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: 
  - `symbol` (ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚·ãƒ³ãƒœãƒ«)
  - `type` ('stock'ã¾ãŸã¯'etf'ã€çœç•¥å¯)

### 6.4 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
```json
{
  "success": true,
  "data": {
    "ticker": "AAPL",
    "price": 174.79,
    "name": "Apple Inc.",
    "currency": "USD",
    "lastUpdated": "2025-03-28T14:24:15.456Z",
    "source": "Yahoo Finance",
    "isStock": true,
    "isMutualFund": false
  }
}
```

## 7. ç±³å›½æ ªã®å–å¾—ï¼ˆAlpaca APIï¼‰

### 7.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Base URL**: `/api/alpaca-api-proxy`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `symbol` (ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚·ãƒ³ãƒœãƒ«)

### 7.2 èªè¨¼
- **API Key**: `ALPACA_API_KEY` ç’°å¢ƒå¤‰æ•°
- **API Secret**: `ALPACA_API_SECRET` ç’°å¢ƒå¤‰æ•°

### 7.3 å®Ÿè£…æ–¹æ³•
- Netlify Functionsã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°
- Alpaca APIã¸ã®ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦æ©Ÿèƒ½
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã¨å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

### 7.4 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
```json
{
  "success": true,
  "data": {
    "ticker": "AAPL",
    "price": 174.79,
    "name": "Apple Inc.",
    "currency": "USD",
    "lastUpdated": "2025-03-25T03:24:15.456Z",
    "source": "Alpaca",
    "isStock": true,
    "isMutualFund": false
  }
}
```

## 8. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚½ãƒ¼ã‚¹ï¼ˆYahoo Finance APIï¼‰

### 8.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Base URL**: `/api/yahoo-finance-proxy`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `symbols` (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚·ãƒ³ãƒœãƒ«)

### 8.2 èªè¨¼
- èªè¨¼ä¸è¦ï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯APIï¼‰

### 8.3 å®Ÿè£…æ–¹æ³•
- Netlify Functionsã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°
- Yahoo Financeéå…¬å¼APIã¸ã®ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦æ©Ÿèƒ½
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã¨å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

### 8.4 ãƒ†ã‚£ãƒƒã‚«ãƒ¼å¤‰æ›
```javascript
// Yahoo Financeç”¨ã®ãƒ†ã‚£ãƒƒã‚«ãƒ¼å¤‰æ›
function formatTickerForYahoo(ticker) {
  // æŠ•è³‡ä¿¡è¨—ã®å ´åˆ
  if (isMutualFund(ticker)) {
    // Cã¨.Tã®å‡¦ç†
    if (ticker.endsWith('.T')) {
      if (!ticker.includes('C')) {
        return ticker.replace(/\.T$/, 'C.T');
      }
      return ticker;
    }
    
    if (!ticker.includes('C')) {
      return `${ticker}C.T`;
    }
    
    return `${ticker}.T`;
  }
  
  // æ—¥æœ¬æ ªã®å ´åˆ
  if (/^\d{4}$/.test(ticker) && !ticker.includes('.T')) {
    return `${ticker}.T`;
  }
  
  return ticker;
}
```

## 9. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆæ›´æ–°ï¼‰

### 9.1 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é †åºï¼ˆç±³å›½æ ªï¼‰
1. Alpaca APIï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹ï¼‰
2. Yahoo Finance APIï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªã‚½ãƒ¼ã‚¹ï¼‰
3. ç±³å›½æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
4. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ï¼ˆã™ã¹ã¦å¤±æ•—ã—ãŸå ´åˆï¼‰

### 9.2 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é †åºï¼ˆæ—¥æœ¬æ ªï¼‰
1. æ—¥æœ¬æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹ï¼‰
2. Yahoo Finance APIï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªã‚½ãƒ¼ã‚¹ï¼‰
3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ï¼ˆã™ã¹ã¦å¤±æ•—ã—ãŸå ´åˆï¼‰

### 9.3 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é †åºï¼ˆæŠ•è³‡ä¿¡è¨—ï¼‰
1. æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹ï¼‰
2. Yahoo Finance APIï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªã‚½ãƒ¼ã‚¹ï¼‰
3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ï¼ˆã™ã¹ã¦å¤±æ•—ã—ãŸå ´åˆï¼‰

### 9.4 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¡ä»¶
1. ãƒ—ãƒ©ã‚¤ãƒãƒªã‚½ãƒ¼ã‚¹ã¨ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚½ãƒ¼ã‚¹ãŒå…±ã«å¤±æ•—ã—ãŸå ´åˆ
2. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆ
3. ãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹ãªå ´åˆ

### 9.5 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã®ç”Ÿæˆ
```javascript
function generateFallbackTickerData(ticker) {
  // æŠ•è³‡ä¿¡è¨—ã®å ´åˆ
  if (isMutualFund(ticker)) {
    return {
      ticker: ticker,
      price: 10000, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåŸºæº–ä¾¡é¡
      name: `æŠ•è³‡ä¿¡è¨— ${ticker}`,
      currency: 'JPY',
      source: 'Fallback',
      isStock: false,
      isMutualFund: true,
      priceLabel: 'åŸºæº–ä¾¡é¡'
    };
  }
  
  // æ—¥æœ¬æ ªã®å ´åˆ
  if (isJapaneseStock(ticker)) {
    return {
      ticker: ticker,
      price: 2500, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ ªä¾¡
      name: `æ—¥æœ¬æ ª ${ticker.replace(/\.T$/, '')}`,
      currency: 'JPY',
      source: 'Fallback',
      isStock: true,
      isMutualFund: false
    };
  }
  
  // ç±³å›½æ ªã®å ´åˆ
  return {
    ticker: ticker,
    price: 150, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ ªä¾¡
    name: ticker,
    currency: 'USD',
    source: 'Fallback',
    isStock: true,
    isMutualFund: false
  };
}
```

## 10. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

### 10.1 å„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- **Alpaca API**: 10ç§’
- **æ—¥æœ¬æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°**: 20ç§’
- **æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°**: 20ç§’
- **ç±³å›½æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°**: 20ç§’ï¼ˆæ–°è¦è¿½åŠ ï¼‰
- **Yahoo Finance API**: 15ç§’
- **exchangerate.host**: 10ç§’

### 10.2 å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- æœ€å¤§3å›ã®è©¦è¡Œï¼ˆåˆå› + 2å›ã®ãƒªãƒˆãƒ©ã‚¤ï¼‰
- ãƒªãƒˆãƒ©ã‚¤ã”ã¨ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶é•·
- ãƒªãƒˆãƒ©ã‚¤é–“ã«çŸ­ã„ã‚¦ã‚§ã‚¤ãƒˆï¼ˆ1ã€œ2ç§’ï¼‰ã‚’æŒ¿å…¥

## 11. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 11.1 ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**: æ¥ç¶šå•é¡Œ
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: å¿œç­”å¾…ã¡æ™‚é–“è¶…é
- **èªè¨¼ã‚¨ãƒ©ãƒ¼**: APIèªè¨¼å¤±æ•—
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æã‚¨ãƒ©ãƒ¼**: ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼
- **ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼**: ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå¤±æ•—

### 11.2 ã‚¨ãƒ©ãƒ¼é€šçŸ¥
```javascript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®çµ±è¨ˆã‚’è¨ˆç®—
const stats = {
  Scraping: { 
    japaneseStocks: { tried: 0, succeeded: 0 },
    mutualFunds: { tried: 0, succeeded: 0 },
    usStocks: { tried: 0, succeeded: 0 } // ç±³å›½æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°çµ±è¨ˆã‚’è¿½åŠ 
  },
  Alpaca: { tried: 0, succeeded: 0 },
  Yahoo: { tried: 0, succeeded: 0 },
  Fallback: 0
};

// çµæœã‚’é›†è¨ˆ

// é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
let message = 'å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ: ';

if (stats.Scraping.japaneseStocks.succeeded > 0) {
  message += `æ—¥æœ¬æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°: ${stats.Scraping.japaneseStocks.succeeded}ä»¶, `;
}

if (stats.Scraping.mutualFunds.succeeded > 0) {
  message += `æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°: ${stats.Scraping.mutualFunds.succeeded}ä»¶, `;
}

if (stats.Scraping.usStocks.succeeded > 0) {
  message += `ç±³å›½æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°: ${stats.Scraping.usStocks.succeeded}ä»¶, `;
}

if (stats.Alpaca.succeeded > 0) {
  message += `Alpaca: ${stats.Alpaca.succeeded}ä»¶, `;
}

if (stats.Yahoo.succeeded > 0) {
  message += `Yahoo Finance: ${stats.Yahoo.succeeded}ä»¶, `;
}

if (stats.Fallback > 0) {
  message += `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ${stats.Fallback}ä»¶, `;
}
```

## 12. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å¯¾å¿œ

### 12.1 ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¡¨ç¤ºãƒãƒƒã‚¸
```jsx
function DataSourceBadge({ source }) {
  let badgeClass = "text-xs px-1.5 py-0.5 rounded ";
  let badgeText = source;

  switch (source) {
    case 'Alpaca':
      badgeClass += "bg-blue-100 text-blue-800";
      break;
    case 'Yahoo Finance Japan':
    case 'Minkabu':
    case 'Kabutan':
    case 'æŠ•è³‡ä¿¡è¨—å”ä¼š':
    case 'Morningstar Japan':
      badgeClass += "bg-green-100 text-green-800";
      badgeText = source === 'Yahoo Finance Japan' ? 'Yahoo JP' : 
                 source === 'Morningstar Japan' ? 'Morningstar' : 
                 source === 'æŠ•è³‡ä¿¡è¨—å”ä¼š' ? 'æŠ•ä¿¡å”ä¼š' : source;
      break;
    case 'Yahoo Finance Scraping':
      badgeClass += "bg-purple-100 text-purple-800";
      badgeText = "Yahoo ğŸ”";
      break;
    case 'MarketWatch':
      badgeClass += "bg-purple-100 text-purple-800";
      badgeText = "MktWatch ğŸ”";
      break;
    case 'Investing.com':
      badgeClass += "bg-purple-100 text-purple-800";
      badgeText = "Invest ğŸ”";
      break;
    case 'Yahoo Finance':
      badgeClass += "bg-purple-100 text-purple-800";
      badgeText = "YFinance";
      break;
    case 'Fallback':
    default:
      badgeClass += "bg-yellow-100 text-yellow-800";
      break;
  }

  return (
    <span className={badgeClass}>
      {badgeText}
    </span>
  );
}
```

### 12.2 ä¾¡æ ¼è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```jsx
function PriceDisplay({ asset }) {
  const { price, currency, isMutualFund } = asset;
  const label = isMutualFund ? 'åŸºæº–ä¾¡é¡' : 'æ ªä¾¡';
  
  return (
    <div className="flex flex-col">
      <span className="text-xs text-gray-500">{label}</span>
      <span className="font-medium">{formatCurrency(price, currency)}</span>
    </div>
  );
}
```

## 13. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´å®Ÿè£…

### 13.1 fetchTickerData é–¢æ•°ï¼ˆæ›´æ–°ï¼‰
```javascript
export async function fetchTickerData(ticker) {
  // éŠ˜æŸ„ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
  const isJapanese = isJapaneseStock(ticker);
  const isMutualFundTicker = isMutualFund(ticker);
  
  // æŠ•è³‡ä¿¡è¨—ã®å ´åˆ
  if (isMutualFundTicker) {
    try {
      // æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è©¦ã¿ã‚‹
      const mutualFundResult = await fetchFromMutualFundScraping(ticker);
      
      if (mutualFundResult && mutualFundResult.success) {
        return mutualFundResult;
      }
      
      // æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€Yahoo Financeã‚’è©¦è¡Œ
      const yahooResult = await fetchFromYahoo(ticker);
      
      if (yahooResult && yahooResult.success) {
        return yahooResult;
      }
      
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨
      return generateFallbackTickerData(ticker);
    } catch (error) {
      return generateFallbackTickerData(ticker);
    }
  }
  
  // æ—¥æœ¬æ ªã®å ´åˆ
  if (isJapanese) {
    try {
      // æ—¥æœ¬æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è©¦ã¿ã‚‹
      const jpStockResult = await fetchFromJPStockScraping(ticker);
      
      if (jpStockResult && jpStockResult.success) {
        return jpStockResult;
      }
      
      // æ—¥æœ¬æ ªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€Yahoo Financeã‚’è©¦è¡Œ
      const yahooResult = await fetchFromYahoo(ticker);
      
      if (yahooResult && yahooResult.success) {
        return yahooResult;
      }
      
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨
      return generateFallbackTickerData(ticker);
    } catch (error) {
      return generateFallbackTickerData(ticker);
    }
  }
  
  // ç±³å›½æ ªã®å ´åˆã¯Alpaca APIã‚’å„ªå…ˆ
  try {
    // Alpaca APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è©¦ã¿ã‚‹
    const alpacaResult = await fetchFromAlpaca(ticker);
    
    if (alpacaResult && alpacaResult.success) {
      return alpacaResult;
    }
    
    // Alpaca APIãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€Yahoo Financeã‚’è©¦è¡Œ
    const yahooResult = await fetchFromYahoo(ticker);
    
    if (yahooResult && yahooResult.success) {
      return yahooResult;
    }
    
    // Yahoo Financeã‚‚å¤±æ•—ã—ãŸå ´åˆã¯ã€ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’è©¦è¡Œï¼ˆæ–°è¦è¿½åŠ ï¼‰
    const isEtf = US_ETF_LIST.includes(ticker);
    const scrapingResult = await fetchFromUSStockScraping(ticker, isEtf ? 'etf' : 'stock');
    
    if (scrapingResult && scrapingResult.success) {
      return scrapingResult;
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨
    return generateFallbackTickerData(ticker);
  } catch (error) {
    return generateFallbackTickerData(ticker);
  }
}
```

## 14. ç•™æ„äº‹é …

### 14.1 ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®åˆ¶ç´„
- ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æ§‹é€ å¤‰æ›´ã«è„†å¼±
- ã‚µã‚¤ãƒˆå´ã®é˜²æ­¢æ©Ÿæ§‹ï¼ˆCAPTCHAç­‰ï¼‰ã«å¯¾å¿œä¸èƒ½
- éåº¦ãªä½¿ç”¨ã«ã‚ˆã‚‹IPãƒ–ãƒ­ãƒƒã‚¯å¯èƒ½æ€§ã‚ã‚Š
- ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨é©åˆ‡ãªé–“éš”ãŒå¿…è¦

### 14.2 å€«ç†çš„ãƒ»æ³•çš„è€ƒæ…®äº‹é …
- å¯¾è±¡ã‚µã‚¤ãƒˆã®åˆ©ç”¨è¦ç´„ã‚’å°Šé‡
- å•†ç”¨åˆ©ç”¨ã«é–¢ã™ã‚‹åˆ¶é™ã‚’ç¢ºèª
- éåº¦ãªè² è·ã‚’ã‹ã‘ãªã„é…æ…®
- ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§ã«é–¢ã™ã‚‹å…è²¬äº‹é …ã‚’æ˜è¨˜

### 14.3 ä»£æ›¿æ‰‹æ®µ
- å…¬å¼APIã®ç™»å ´ã«å‚™ãˆé©å®œå®Ÿè£…ã‚’è¦‹ç›´ã—
- ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒã‚¤ãƒ€å¥‘ç´„ã®æ¤œè¨
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰‹å‹•å…¥åŠ›æ©Ÿèƒ½ã®æä¾›

## æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å†…å®¹ | æ‹…å½“è€… |
|---|---|---|---|
| 1.0 | 2025/03/15 | åˆç‰ˆä½œæˆ |  |
| 2.0 | 2025/03/18 | Alpha Vantage APIè¿½åŠ  |  |
| 3.0 | 2025/03/21 | Alpaca APIã¸ã®å¤‰æ›´ |  |
| 4.0 | 2025/03/23 | Yahoo Finance APIã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦è¿½åŠ  |  |
| 5.0 | 2025/03/25 | æ—¥æœ¬æ ªãŠã‚ˆã³æŠ•è³‡ä¿¡è¨—ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾å¿œè¿½åŠ  |  |
| 6.0 | 2025/03/28 | ç±³å›½æ ªãƒ»ETFã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾å¿œè¿½åŠ  |  |
